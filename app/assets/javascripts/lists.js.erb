
$(document).on('turbolinks:load',function(){
  
  $('.edit_task').submitOnCheck();

  // Add class active to selected list and change form action in datepicker to point to the new list
  $('.collection-item').click(function(){
     $('.collection-item').removeClass('active');
     $(this).addClass('active');

     var id = $('#collection-list a.active').attr('id');
     $("#form_date").attr('action', '/lists/' + id);
  });

  var d = new Date();
  console.log(d);
  var $input = $('#mainDate').pickadate();

  // Use the picker object directly.
  var picker = $input.pickadate('picker');
  picker.set('select', d);

  // $('#mainDate').datepicker({
  //   dateFormat: "yy-mm-dd",
  //   onClose: function(dateText,datePickerInstance){
  //     var oldValue = $(this).data('oldValue') || "";
  //             if (dateText !== oldValue) {
  //                 $(this).data('oldValue',dateText);
  //                 $(this).trigger('dateupdated');
  //             }
  //           }
  // });
  // var d= new Date(),
  //     date = $('#mainDate').data('oldValue') || d;
  //       console.log(date);
  // picker.set('select', d);
  // $('#mainDate').datepicker("setDate", date);

  $('body').on('dateupdated','#mainDate', function(e) {
    var date = $('#mainDate').val();
    $('#mainDate').parent('form').submit();

    });

  $('#today').click(function(){
    var d = new Date();
    $('#mainDate').datepicker( "setDate", d );
    console.log($('#mainDate').val());
    $('#mainDate').parent('form').submit();
  });

});
